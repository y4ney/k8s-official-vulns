---[CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

此漏洞允许使用[子路径卷挂载](https://kubernetes.io/docs/concepts/storage/volumes/#using-subpath)的容器（包括任何卷类型，受文件权限限制的非特权Pod）访问卷外部的文件/目录，包括宿主机的文件系统。

感谢Maxim Ivanov报告此问题。

**受影响版本：**
* Kubernetes 1.3.x-1.6.x
* Kubernetes 1.7.0-1.7.13
* Kubernetes 1.8.0-1.8.8
* Kubernetes 1.9.0-1.9.3

**受影响配置：**
* 允许不受信用户控制Pod spec内容，并通过PodSecurityPolicy（或自定义准入插件）阻止通过hostPath卷（或其他卷类型）访问宿主机文件系统的集群
* 对不受信容器或可能被入侵的容器使用[子路径卷挂载](https://kubernetes.io/docs/concepts/storage/volumes/#using-subpath)的集群

**漏洞影响：**
精心构造的Pod spec结合恶意容器行为，可实现对Pod指定卷外任意文件的读写访问，包括宿主机文件系统。此漏洞可通过任何卷类型（包括emptyDir）触发，且可由非特权Pod实现（受文件权限限制）。

**升级前缓解措施：**
阻止不受信用户创建Pod（及Deployment、ReplicaSet等能创建Pod的对象），或通过PodSecurityPolicy[禁用所有卷类型](https://kubernetes.io/docs/concepts/policy/pod-security-policy/#volumes-and-file-systems)（注意这将导致Pod无法使用服务账户令牌，需设置[`automountServiceAccountToken: false`](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#use-the-default-service-account-to-access-the-api-server)）

**已修复版本：**
* v1.7.14 通过 #61047 修复
* v1.8.9 通过 #61046 修复
* v1.9.4 通过 #61045 修复
* master分支通过 #61044 修复（包含在v1.10.0-beta.3中，将在v1.10.0正式发布）

**必须操作：**
除升级外，设计用于限制容器权限的PodSecurityPolicy对象必须完全[禁用hostPath卷](https://kubernetes.io/docs/concepts/policy/pod-security-policy/#volumes-and-file-systems)，因为allowedHostPaths特性无法限制符号链接的创建和遍历。在PodSecurityPolicy能有效将hostPath使用限制到特定子路径前，需通过未来增强功能（由issue #61043跟踪）实现只读卷或精确路径匹配的限制。

**已知问题：**
* 子路径卷挂载处理回归问题的修复状态及进展跟踪详见：https://github.com/kubernetes/kubernetes/issues/61563