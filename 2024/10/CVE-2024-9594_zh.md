---CVSS 评分：[CVSS:3.1/AV:A/AC:H/PR:H/UI:R/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:A/AC:H/PR:H/UI:R/S:U/C:H/I:H/A:H)

在 Kubernetes 镜像构建器中发现一个安全问题：当使用 Nutanix、OVA、QEMU 或 raw 提供商时，镜像构建过程中会启用默认凭据。攻击者可利用这些凭据获取 root 权限。镜像构建完成后这些凭据会被禁用。仅当 Kubernetes 集群节点使用通过镜像构建器项目创建的虚拟机镜像时才会受到影响。

### 我是否受影响？

使用 Kubernetes 镜像构建器 (https://github.com/kubernetes-sigs/image-builder) v0.1.37 或更早版本构建的虚拟机镜像（通过 Nutanix、OVA、QEMU 或 raw 提供商）会受到影响。这些镜像仅在构建过程中存在漏洞，且需要攻击者能够访问正在构建镜像的虚拟机并利用该漏洞在构建时修改镜像。

使用 Proxmox 提供商构建的镜像存在一个相关但更严重的漏洞（参见 #128006）。

使用其他所有提供商构建的镜像不受此问题影响。

可通过以下方式确认您使用的镜像构建器版本：
- 对于通过 git 克隆的镜像构建器仓库：
```
    cd <本地镜像构建器仓库路径>
    make version
```
- 对于通过压缩包安装的情况：
```
    cd <本地安装路径>
    grep -o v0\\.[0-9.]* RELEASE.md | head -1
```
- 对于容器镜像版本：
    `docker run --rm <镜像拉取标识> version`
  或
    `podman run --rm <镜像拉取标识> version`
  或查看镜像标签（如官方镜像 `registry.k8s.io/scl-image-builder/cluster-node-image-builder-amd64:v0.1.37`）

#### 受影响版本

- Kubernetes 镜像构建器版本 <= v0.1.37

### 如何缓解此漏洞？

使用已修复版本的镜像构建器重新构建受影响镜像，并将修复后的镜像重新部署到所有受影响的虚拟机。

#### 修复版本

- Kubernetes 镜像构建器 master 分支 - 通过 https://github.com/kubernetes-sigs/image-builder/pull/1596 修复
- Kubernetes 镜像构建器 v0.1.38 版本已修复

### 检测方法

Linux 命令 `last builder` 可用于查看受影响 `builder` 账户的登录记录。

如发现此漏洞被利用的证据，请联系 security@kubernetes.io

## 补充信息

修复版本会在镜像构建期间设置随机生成的密码

#### 致谢

此漏洞由 Rybnikar Enterprises GmbH 的 Nicolai Rybnikar @rybnico 报告。

问题由镜像构建器项目的 Marcus Noble 修复并协调处理。

/area security
/kind bug
/committee security-response
/label official-cve-feed
/sig cluster-lifecycle