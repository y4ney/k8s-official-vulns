---CVSS 评分: [CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

在 Kubernetes Image Builder 中发现一个安全问题：镜像构建过程中启用了默认凭据。此外，使用 Proxmox 提供程序构建的虚拟机镜像未禁用这些默认凭据，使用这些镜像的节点可能通过这些默认凭据被访问。攻击者可以利用这些凭据获取 root 权限。仅当 Kubernetes 集群节点使用 Image Builder 项目的 Proxmox 提供程序创建的虚拟机镜像时才会受到影响。

### 我是否受影响？

使用 Kubernetes Image Builder (https://github.com/kubernetes-sigs/image-builder) v0.1.37 或更早版本构建的虚拟机镜像（通过 Proxmox 提供程序构建）的集群会受到影响。

使用其他所有提供程序构建的镜像不受此问题影响。有关影响其他部分提供程序的类似问题，请参阅 #128007。

可通过以下方法确定您使用的 Image Builder 版本：
- 对于通过 git clone 获取的镜像构建器仓库：
```
    cd <本地镜像构建器仓库路径>
    make version
```
- 对于通过 tarball 下载安装的情况：
```
    cd <本地安装路径>
    grep -o v0\\.[0-9.]* RELEASE.md | head -1
```
- 对于容器镜像发布版本：
    `docker run --rm <镜像拉取规格> version`
  或
    `podman run --rm <镜像拉取规格> version`
  或查看指定的镜像标签（如官方镜像 `registry.k8s.io/scl-image-builder/cluster-node-image-builder-amd64:v0.1.37`）

#### 受影响版本

- Kubernetes Image Builder 版本 <= v0.1.37

### 如何缓解此漏洞？

使用已修复版本的 Image Builder 重新构建所有受影响的镜像，并将修复后的镜像重新部署到所有受影响的虚拟机。

在升级前，可通过在受影响的虚拟机上禁用 builder 账户来缓解此漏洞：
usermod -L builder

#### 已修复版本

- Kubernetes Image Builder master 分支 - 通过 https://github.com/kubernetes-sigs/image-builder/pull/1595 修复
- 已在 Kubernetes Image Builder v0.1.38 版本中修复

### 检测方法

可使用 Linux 命令 `last builder` 查看受影响 `builder` 账户的登录记录。

如发现此漏洞被利用的证据，请联系 security@kubernetes.io

## 补充说明

修复版本通过以下两项变更修复此漏洞：
- 在镜像构建期间设置随机生成的密码
- 在镜像构建完成后禁用 builder 账户

#### 致谢

此漏洞由 Rybnikar Enterprises GmbH 的 Nicolai Rybnikar @rybnico 报告。

问题由 Image Builder 项目的 Marcus Noble 修复并协调处理。

/area security
/kind bug
/committee security-response
/label official-cve-feed
/sig cluster-lifecycle