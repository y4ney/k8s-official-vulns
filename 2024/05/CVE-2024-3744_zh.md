---CVSS 评分: [CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:C/C:H/I:N/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:C/C:H/I:N/A:N) - **中危** (6.5)

在 azure-file-csi-driver 中发现一个安全问题，拥有驱动日志访问权限的攻击者可观察到服务账户令牌。这些令牌可能被用于与外部云提供商交换，以访问存储在云保险库解决方案中的机密信息。仅当 [CSIDriver 对象中配置了 TokenRequests](https://kubernetes-csi.github.io/docs/token-requests.html) 且驱动通过 -v 标志设置为日志级别 2 或更高时，令牌才会被记录。

此问题被评为 **中危** [CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:C/C:H/I:N/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:C/C:H/I:N/A:N) (6.5)，并分配了 **CVE-2024-3744**。

### 我是否受影响？

如果您在 [CSIDriver 对象中配置了 TokenRequests](https://kubernetes-csi.github.io/docs/token-requests.html) 且驱动通过 -v 标志设置为日志级别 2 或更高，则可能受影响。

要检查是否配置了令牌请求，请运行以下命令：

kubectl get csidriver file.csi.azure.com -o jsonpath="{.spec.tokenRequests}"

要检查令牌是否被记录，请检查 secrets-store 容器日志：

kubectl logs csi-azurefile-controller-56bfddd689-dh5tk -c azurefile -f | grep --line-buffered "csi.storage.k8s.io/serviceAccount.tokens"

#### 受影响版本

- azure-file-csi-driver <= v1.29.3
- azure-file-csi-driver v1.30.0

### 如何缓解此漏洞？

在升级前，可通过将 azure-file-csi-driver 的日志级别设置为 0 或 1（使用 -v 标志）来缓解此漏洞。

#### 已修复版本

- azure-file-csi-driver v1.29.4
- azure-file-csi-driver v1.30.1

升级方法请参考文档：https://github.com/kubernetes-sigs/azurefile-csi-driver?tab=readme-ov-file#install-driver-on-a-kubernetes-cluster

### 检测方法

检查云提供商日志中是否存在异常的令牌交换行为，以及对云资源的异常访问。

如果您发现此漏洞被利用的证据，请联系 security@kubernetes.io

#### 致谢

此漏洞由 Microsoft 的 Weizhi Chen @cvvz 修复。

感谢您，
Kubernetes 安全响应委员会代表 Rita Zhang

/triage accepted  
/lifecycle frozen  
/area security  
/kind bug  
/committee security-response