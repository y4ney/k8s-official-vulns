---在 Kubernetes 中发现一个安全漏洞，允许具有创建 Pod 并关联 gitRepo 卷能力的用户在容器边界外执行任意命令。该漏洞利用目标仓库中的 hooks 文件夹在容器边界外运行任意命令。

请注意，此问题最初已于 7 月公开披露并修复 (#124531)，我们追溯性地为其分配了 CVE 编号以便于跟踪和提升认知。

该漏洞被评为高危 ([CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:N)) (评分: 8.1)，并分配了 CVE-2024-10220。

### 我是否受影响？

此 CVE 影响使用内置 gitRepo 卷将仓库克隆到子目录的 Pod 所在的 Kubernetes 集群。如果 Kubernetes 集群运行在以下受影响版本之一，则存在此漏洞风险。

#### 受影响版本

- kubelet v1.30.0 至 v1.30.2
- kubelet v1.29.0 至 v1.29.6
- kubelet <= v1.28.11

### 如何缓解此漏洞？

要缓解此漏洞，必须将 Kubernetes 集群升级至以下已修复版本之一。

此外，由于 gitRepo 卷已被弃用，推荐解决方案是使用 init 容器执行 Git 克隆操作，然后将目录挂载到 Pod 的容器中。此方法的示例见[此处](https://gist.github.com/tallclair/849601a16cebeee581ef2be50c351841)。

#### 已修复版本

* kubelet master/v1.31.0  - 通过 #124531 修复
* kubelet v1.30.3  - 通过 #125988 修复
* kubelet v1.29.7 - 通过 #125989 修复
* kubelet v1.28.12 - 通过 #125990 修复

### 检测

要检测此漏洞是否被利用，可使用以下命令列出所有使用内置 gitRepo 卷并克隆到 .git 子目录的 Pod。

```
kubectl get pods --all-namespaces -o json | jq '.items[] | select(.spec.volumes[].gitRepo.directory | endswith("/.git")) | {name: .metadata.name, namespace: .metadata.namespace}
```

如发现该漏洞被利用的证据，请联系 security@kubernetes.io

#### 致谢

此漏洞由 Imre Rad 报告并协助修复。

/area security
/kind bug
/committee security-response
/label official-cve-feed
/sig node
/area kubelet