---CVSS 评分：[CVSS:3.1/AV:A/AC:H/PR:N/UI:N/S:U/C:L/I:N/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:A/AC:H/PR:N/UI:N/S:U/C:L/I:N/A:N) - **低危** (3.1)

Kubernetes 中发现一个安全问题：恶意或被入侵的 Pod 可能在命名空间删除期间绕过网络策略实施的网络限制。命名空间终止期间对象的删除顺序未被明确定义，网络策略有可能先于其保护的 Pod 被删除。这会导致短暂的时间窗口内 Pod 仍在运行并接受网络连接，但网络策略限制未被应用。

### 我的集群是否受影响？

所有依赖网络策略的集群都可能受影响。运行以下命令检查是否使用了网络策略：

```
kubectl get networkpolicies.networking.k8s.io --all-namespaces
```

#### 受影响版本

kube-apiserver >= v1.3

### 如何缓解此漏洞？

可通过以下方式缓解此问题：

- 在开始删除命名空间前，手动删除 Pod 及编排 Pod 的工作负载资源

- 为网络策略添加 Finalizer，确保其保护的 Pod 优先删除后才会被删除。以下概念验证控制器可自动化此过程：

https://github.com/kubernetes-sigs/network-policy-finalizer 

#### 修复版本

- 暂无。长期完整修复方案参见以下 KEP 提案：https://github.com/kubernetes/enhancements/pull/5095 

### 检测方法

网络策略用户可通过网络日志检测潜在滥用行为。具体检测方式因环境而异。

如发现此漏洞被利用的证据，请联系 security@kubernetes.io

#### 致谢

此漏洞由 John McGuinness @s1xtw03 和 Aaron Coffey @aaroncoffey 报告。

协调人员包括：

Antonio Ojea @aojea  
Tim Hockin @thockin  
Dan Winship @danwinship  
Shane Utt @shaneutt  
David Eads @deads2k  
Clayton Colemon @smarterclayton  
Mo Khan @enj  
Craig Ingram @cji  

/label official-cve-feed  
/triage accepted  
/lifecycle frozen  
/area security  
/kind bug  
/committee security-response