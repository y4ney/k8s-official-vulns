---CVSS 评分: [CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

在 ingress-nginx 中发现一个安全问题，拥有创建 Ingress 对象权限（在 `networking.k8s.io` 或 `extensions` API 组中）的攻击者可以绕过注解验证，注入任意命令并获取 ingress-nginx 控制器的凭据。在默认配置中，该凭据拥有访问集群中所有 Secret 的权限。

此问题被评为 **高危** (8.8) [CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)，并分配了 **CVE-2024-7646**。

### 我是否受影响？

此漏洞影响 ingress-nginx。如果您的集群未安装 ingress-nginx，则不受影响。您可以通过运行 `kubectl get po -A` 并查找 `ingress-nginx-controller` 来确认。

允许非管理员用户创建 Ingress 对象的多租户环境受此问题影响最大。

### 受影响版本

ingress-nginx controller < v1.11.2  
ingress-nginx controller < v1.10.4

### 如何缓解此漏洞？

升级到已修复版本可缓解此问题。

### 修复版本

ingress-nginx controller v1.11.2 - 通过 https://github.com/kubernetes/ingress-nginx/pull/11719 和 https://github.com/kubernetes/ingress-nginx/pull/11721 修复  
ingress-nginx controller v1.10.4 - 通过 https://github.com/kubernetes/ingress-nginx/pull/11718 和 https://github.com/kubernetes/ingress-nginx/pull/11722 修复

### 检测方法

检查 Kubernetes 审计日志中创建的 Ingress 对象，查看是否包含回车符 (`\r`) 的注解（例如 `nginx.ingress.kubernetes.io/auth-tls-verify-client`）。

如果发现此漏洞被利用的证据，请联系 [security@kubernetes.io](mailto:security@kubernetes.io)

### 更多详情

详见 GitHub issue:  
https://github.com/kubernetes/kubernetes/issues/126744  

#### 致谢

此漏洞由 André Storfjord Kristiansen @dev-bio 报告。

修复团队协调并修复了该问题:  
André Storfjord Kristiansen @dev-bio  
Jintao Zhang @tao12345666333  
Marco Ebert @Gacko  

/triage accepted  
/lifecycle frozen  
/area security  
/kind bug  
/committee security-response