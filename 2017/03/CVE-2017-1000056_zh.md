# PodSecurityPolicy 准入插件漏洞允许用户使用任何 PodSecurityPolicy 对象，即使未被授权

CVE: CVE-2017-1000056

* 已在 [v1.5.5](https://github.com/kubernetes/kubernetes/releases/tag/v1.5.5) 中修复，提交记录：https://github.com/kubernetes/kubernetes/commit/7fef0a4f6a44ea36f166c39fdade5324eff2dd5e
* 已在 release-1.5 分支修复：https://github.com/kubernetes/kubernetes/pull/43491
* 已在 master 分支修复：https://github.com/kubernetes/kubernetes/pull/43489

**受影响范围**  
仅同时满足以下所有条件的 Kubernetes 1.5.0-1.5.4 版本安装：

* 启用了 PodSecurityPolicy API（默认未启用）：
      `--runtime-config=extensions/v1beta1/podsecuritypolicy=true`
* 启用了 PodSecurityPolicy 准入插件（默认未启用）：
      `--admission-control=...,PodSecurityPolicy,...`
* 使用授权机制限制用户使用特定 PodSecurityPolicy 对象的能力

kubeadm 和 GKE 在 1.5 版本中不允许启用 PodSecurityPolicy，因此不受此漏洞影响。

kube-up.sh 和 kops 默认不启用 PodSecurityPolicy，因此不受此漏洞影响。但修改过的 kube-up.sh 或 kops 部署可能已启用该功能。

**漏洞影响**  
被授权创建 Pod 的用户可以利用任何现有的 PodSecurityPolicy，即使他们未被授权使用这些策略。

**在安装 1.5.5 版本前如何缓解？**  
1. 导出现有 PodSecurityPolicy 对象：
      `kubectl get podsecuritypolicies -o yaml > psp.yaml`

2. 检查并删除不希望所有 Pod 创建用户使用的 PodSecurityPolicy 对象（注意：正在使用这些策略的特权用户也将失去访问权限）。例如：
      `kubectl delete podsecuritypolicies/my-privileged-policy`

3. 升级到 1.5.5 后，重新创建导出的 PodSecurityPolicy 对象：
      `kubectl create -f psp.yaml`