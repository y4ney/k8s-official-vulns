---  
CVSS 评分：**中危** ([CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L))  

此漏洞影响多租户集群。如果潜在攻击者已具备创建或编辑服务和 Pod 的权限，则可能拦截集群中其他 Pod（或节点）的流量。  

能够创建 ClusterIP 服务并设置 `spec.externalIPs` 字段的攻击者可拦截流向该 IP 的流量。能够修补 LoadBalancer 服务状态（此操作被视为特权操作，通常不应授予用户）的攻击者，可通过设置 `status.loadBalancer.ingress.ip` 达到类似效果。  
此问题属于设计缺陷，若不进行面向用户的变更则无法缓解。  

### 受影响组件与配置  

所有 Kubernetes 版本均受影响。授予租户创建和更新服务及 Pod 权限的多租户集群风险最高。  

### 缓解措施  

此问题暂无补丁，目前仅能通过限制对漏洞功能的访问来缓解。由于修复需涉及破坏性变更，我们将在保密期结束后讨论长期解决方案或内置缓解机制。  

为限制外部 IP 的使用，我们提供了准入 Webhook 容器：`k8s.gcr.io/multitenancy/externalip-webhook:v1.0.0`。源代码和部署说明发布于：https://github.com/kubernetes-sigs/externalip-webhook。  

也可使用 [OPA Gatekeeper](https://github.com/open-policy-agent/gatekeeper) 限制外部 IP。示例 ConstraintTemplate 和 Constraint 参见：https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/externalip。  

LoadBalancer IP 未提供缓解措施，因我们不建议授予用户 *patch service/status* 权限。如需限制 LoadBalancer IP，可参照外部 IP 的缓解方案实施。  

### 检测  

ExternalIP 服务并不常用，建议人工审计所有外部 IP 使用记录。用户不应修补服务状态，因此由用户发起的 patch service status 请求审计事件可能可疑。  

若发现此漏洞遭利用的证据，请联系 security@kubernetes.io  

#### 致谢  

此漏洞由 Anevia 的 Etienne Champetier (@champtar) 报告。  

/area security  
/kind bug  
/committee product-security  
/sig network