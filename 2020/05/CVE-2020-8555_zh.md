---CVSS 评分: [CVSS:3.0/AV:N/AC:H/PR:L/UI:N/S:C/C:H/I:N/A:N](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:H/PR:L/UI:N/S:C/C:H/I:N/A:N)

kube-controller-manager 中存在一个服务端请求伪造 (SSRF) 漏洞，该漏洞允许某些授权用户从主节点主机网络内的未受保护端点（如链路本地或环回服务）泄露最多 500 字节的任意信息。

具有创建特定内置 Volume 类型（GlusterFS、Quobyte、StorageOS、ScaleIO）Pod 权限或创建 StorageClass 权限的攻击者，可以诱使 kube-controller-manager 从主节点主机网络发起 GET 请求或不包含攻击者控制请求体的 POST 请求。

### 我是否受影响？

如果您符合以下情况，则可能受影响：

- 正在运行受影响版本（见下文）
- 存在通常仅 Kubernetes 主节点可见的未受保护端点（包括链路本地元数据端点、监听 localhost 的未认证服务或主节点私有网络中的其他服务）
- 非受信用户可以创建使用受影响 Volume 类型的 Pod 或修改 StorageClass

#### 受影响版本

- kube-controller-manager v1.18.0
- kube-controller-manager v1.17.0 - v1.17.4
- kube-controller-manager v1.16.0 - v1.16.8
- kube-controller-manager <= v1.15.11

受影响的 Volume 类型包括：GlusterFS、Quobyte、StorageOS、ScaleIO

### 如何缓解此漏洞？

在升级前，可通过以下方式缓解此漏洞：
- 在主节点上增加端点保护
- 限制易受攻击 Volume 类型的使用（例如通过 [PodSecurityPolicy](https://kubernetes.io/docs/concepts/policy/pod-security-policy/#volumes-and-file-systems) 或第三方准入控制器如 [Gatekeeper](https://github.com/open-policy-agent/gatekeeper) 进行约束）
- 通过 RBAC 限制 StorageClass 的写入权限

#### 已修复版本

以下版本已修复该信息泄露问题：

- kube-controller-manager master - 通过 https://github.com/kubernetes/kubernetes/pull/89794 修复
- kube-controller-manager v1.18.1+ - 通过 https://github.com/kubernetes/kubernetes/pull/89796 修复
- kube-controller-manager v1.17.5+ - 通过 https://github.com/kubernetes/kubernetes/pull/89837 修复
- kube-controller-manager v1.16.9+ - 通过 https://github.com/kubernetes/kubernetes/pull/89838 修复
- kube-controller-manager v1.15.12+ - 通过 https://github.com/kubernetes/kubernetes/pull/89839 修复

升级方法请参考文档：https://kubernetes.io/docs/tasks/administer-cluster/cluster-management/#upgrading-a-cluster

## 补充说明

利用此漏洞会导致 kube-controller-manager 向用户提供的未验证 URL 发起请求。该请求不包含任何 kube-controller-manager 客户端凭据。

#### 致谢

此漏洞由 Groupe-Asten 的 Brice Augras 和 Nokia 的 Christophe Hauquiert 报告。

/area security
/kind bug
/committee product-security
/sig storage
/area controller-manager