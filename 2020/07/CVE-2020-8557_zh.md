---  
CVSS 评分：中危 (5.5) [CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H/CR:H/IR:H/AR:M](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H/CR:H/IR:H/AR:M)  

kubelet 挂载到 Pod 中的 `/etc/hosts` 文件未被 kubelet 驱逐管理器计入 Pod 的临时存储用量统计。如果 Pod 向 `/etc/hosts` 文件写入大量数据，可能占满节点存储空间并导致节点故障。  

### 我的集群是否受影响？  

任何允许 Pod 以足够权限向自身 `/etc/hosts` 文件写入数据的集群均受影响。包括以下情况：  
- 容器 capability 边界集中包含 `CAP_DAC_OVERRIDE`（默认包含）  
- 同时满足以下任一条件：  
  - 以 UID 0 (root) 运行  
  - 安全上下文设置 `allowPrivilegeEscalation: true`（默认为 true）  

#### 受影响版本  
- kubelet v1.18.0-1.18.5  
- kubelet v1.17.0-1.17.8  
- kubelet < v1.16.13  

### 如何缓解此漏洞？  

在升级前可通过以下方式缓解：  
- 使用 PodSecurityPolicy 或其他准入 Webhook 强制容器：  
  - 移除 `CAP_DAC_OVERRIDE` capability  
  - 禁止特权提升及以 root 身份运行  
注意：这些措施可能导致依赖这些权限的现有工作负载异常。  

#### 已修复版本  
- kubelet master 分支 - 通过 #92916 修复  
- kubelet v1.18.6 - 通过 #92921 修复  
- kubelet v1.17.9 - 通过 #92923 修复  
- kubelet v1.16.13 - 通过 #92924 修复  

升级指南详见：https://kubernetes.io/docs/tasks/administer-cluster/cluster-management/#upgrading-a-cluster  

### 检测方法  

异常的 Pod `etc-hosts` 文件大小可能表明存在利用此漏洞的拒绝服务攻击。在节点上执行以下命令可检测异常文件：  

```  
find /var/lib/kubelet/pods/*/etc-hosts -size +1M  
```  

#### 致谢  

本漏洞由 DaoCloud 工程师 Kebe Liu 通过 Kubernetes 漏洞赏金计划报告。  

/area security  
/kind bug  
/committee product-security  
/sig node  
/area kubelet