# Kubernetes 安全公告

在 kubectl v1.8.0+ 版本中，模式(schema)信息会被缓存到 `--cache-dir` 指定的目录(默认为 `$HOME/.kube/http-cache`)，且文件权限设置为全局可写(rw-rw-rw-)。

如果指定了 `--cache-dir` 并指向其他用户/组可访问的位置，那么写入的文件可能被其他用户/组修改，从而干扰 kubectl 的正常调用。

CVSS 评分: CVSS:3.0/AV:L/AC:H/PR:L/UI:R/S:U/C:L/I:L/A:N (3.3，低危)

**受影响版本**
kubectl v1.8.0+

**受影响配置**
将 `--cache-dir` 指向全局可写位置的调用

**影响**
写入缓存目录的畸形响应可能会干扰 kubectl 调用

**临时解决方案**
使用 $HOME 目录下的默认 `--http-cache` 位置，或将其指向仅限特定用户/组访问的目录

(原始描述如下) ====
问题现象: ".kube/http-cache" 目录下的文件设置为全局可写(rw-rw-rw-)。虽然这些文件默认存放在主目录下，但使用 "--cache-dir" 标志可能会将这些文件放在允许任何用户/进程修改缓存文件的位置。修改缓存文件可能会对其他用户的 kubectl 工具造成负面影响。

预期行为: 对 http-cache 文件应用更严格的权限设置。

重现步骤(尽可能最小化和精确):
运行任意成功的 kubectl 命令，然后列出缓存目录 ~/.kube/http-cache/*
  
$ kubectl get pods --all-namespaces
$ ls -la ~/.kube/http-cache/*

其他需要了解的信息: 我评估这是一个低危安全问题，CVSS 评分为 "3.3 / CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N" - https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N

环境: Linux
 
Kubernetes 版本(kubectl version):
Client Version: version.Info{Major:"1", Minor:"12", GitVersion:"v1.12.6", GitCommit:"ab91afd7062d4240e95e51ac00a18bd58fddd365", GitTreeState:"clean", BuildDate:"2019-02-26T12:49:28Z", GoVersion:"go1.10.8", Compiler:"gc", Platform:"linux/amd64"}
Server Version: version.Info{Major:"1", Minor:"12", GitVersion:"v1.12.6", GitCommit:"ab91afd7062d4240e95e51ac00a18bd58fddd365", GitTreeState:"clean", BuildDate:"2019-02-26T12:49:28Z", GoVersion:"go1.10.8", Compiler:"gc", Platform:"linux/amd64"}

云服务商或硬件配置: AWS。在 hyperkube 中运行 kube api server。

操作系统(cat /etc/os-release):
NAME="CentOS Linux"
VERSION="7.1808 (Core)"
ID="centos"
ID_LIKE="rhel fedora"
VERSION_ID="7"
PRETTY_NAME="CentOS Linux 7.1808 (Core)"
ANSI_COLOR="0;31"
CPE_NAME="cpe:/o:centos:centos:7"
HOME_URL="https://www.centos.org/"
BUG_REPORT_URL="https://bugs.centos.org/"
CENTOS_MANTISBT_PROJECT="CentOS-7"
CENTOS_MANTISBT_PROJECT_VERSION="7"
REDHAT_SUPPORT_PRODUCT="centos"
REDHAT_SUPPORT_PRODUCT_VERSION="7"
OSTREE_VERSION=7.1808
 
内核版本(uname -a): Linux hackit.internal 3.10.0-862.11.6.el7.x86_64 #1 SMP Tue Aug 14 21:49:04 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux
 
安装工具: 手动安装
 
其他: 无