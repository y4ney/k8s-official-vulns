---CVSS:3.0/AV:N/AC:H/PR:L/UI:N/S:U/C:L/I:N/A:N

`rest.AnonymousClientConfig()` 方法会返回一个移除了凭据（Bearer Token、用户名/密码、客户端证书/密钥数据）的配置副本。

在以下版本中，`rest.AnonymousClientConfig()` 未能有效清除通过 `rest.InClusterConfig()` 加载的服务账号凭据：
* v1.12.0-v1.12.4
* v1.13.0

**影响范围**
* 直接对通过 `rest.InClusterConfig()` 加载的客户端配置使用 `rest.AnonymousClientConfig()` 方法的 `k8s.io/client-go` 用户，获取的客户端配置仍可能携带已加载的服务账号令牌发送请求。

**修复方案**
* 在 1.12.5+ 和 1.13.1+ 版本中，修改了 `rest.InClusterConfig()` 使其返回的客户端配置可安全用于 `rest.AnonymousClientConfig()` 方法 (https://github.com/kubernetes/kubernetes/pull/71713)
* 在 v1.15.0 版本中，`rest.AnonymousClientConfig()` 除了显式携带凭据的字段外，还将排除 `config.Transport` 和 `config.WrapTransport` 字段 (https://github.com/kubernetes/kubernetes/pull/75771)

**解决方案**
* 将 `k8s.io/client-go` 升级至 `kubernetes-1.12.5`、`kubernetes-1.13.1`、`kubernetes-1.14.0` 或更高版本
* 或在调用 `rest.AnonymousClientConfig()` 后手动清除 `config.WrapTransport` 和 `config.Transport` 字段

感谢 Red Hat 的 Oleg Bulatov 报告此问题。

/area security
/kind bug
/sig auth
/sig api-machinery
/assign
/close