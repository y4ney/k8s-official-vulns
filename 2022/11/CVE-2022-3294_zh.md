---CVSS 评分: [CVSS:3.1/AV:N/AC:H/PR:H/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:H/PR:H/UI:N/S:U/C:H/I:H/A:H)

在 Kubernetes 中发现一个安全问题，用户可能访问控制平面网络中的安全端点。仅当不受信任的用户能够修改 Node 对象并向其发送代理请求时，Kubernetes 集群才会受到影响。

Kubernetes 支持节点代理功能，允许 kube-apiserver 的客户端访问 Kubelet 端点以建立与 Pod 的连接、获取容器日志等。虽然 Kubernetes 已对节点的代理地址进行验证，但 kube-apiserver 中的一个漏洞使得可以绕过此验证。绕过验证可能导致发往节点的认证请求被重定向到 API 服务器的私有网络。

### 我的集群是否受影响？

如果存在 kube-apiserver 可以连接但用户不应访问的端点，则集群会受到此漏洞影响。包括以下情况：

- kube-apiserver 与工作节点位于不同网络
- localhost 服务

接受与节点相同客户端证书的 mTLS 服务可能受影响。此问题的严重性取决于可利用端点的权限和敏感程度。

配置了出口选择器使用代理处理集群流量的集群可能不受影响。

#### 受影响版本

- Kubernetes kube-apiserver <= v1.25.3  
- Kubernetes kube-apiserver <= v1.24.7  
- Kubernetes kube-apiserver <= v1.23.13  
- Kubernetes kube-apiserver <= v1.22.15  

### 如何缓解此漏洞？

将 **kube-apiserver** 升级到已修复版本可缓解此漏洞。

除升级外，配置[集群网络出口的出口代理](https://kubernetes.io/docs/tasks/extend-kubernetes/setup-konnectivity/)也可缓解此漏洞。

#### 已修复版本

- Kubernetes kube-apiserver v1.25.4  
- Kubernetes kube-apiserver v1.24.8  
- Kubernetes kube-apiserver v1.23.14  
- Kubernetes kube-apiserver v1.22.16  

**修复影响：** 在某些情况下，该修复可能会破坏依赖 nodes/proxy 子资源的客户端，特别是当 kubelet 向 Kubernetes 控制平面通告 localhost 或链路本地地址时。

### 检测

节点创建和更新请求可能包含在 Kubernetes 审计日志中，可用于识别不应允许的 IP 地址请求。节点代理请求也可能记录在审计日志中。

如果发现此漏洞被利用的证据，请联系 security@kubernetes.io

#### 致谢

此漏洞由 Palo Alto Networks 的 Yuval Avrahami 报告。

<!-- labels -->
/area security
/kind bug
/committee security-response
/label official-cve-feed
/sig api-machinery
/area apiserver