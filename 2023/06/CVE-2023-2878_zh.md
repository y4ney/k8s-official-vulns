---  
在 [secrets-store-csi-driver](https://github.com/kubernetes-sigs/secrets-store-csi-driver) 中发现一个安全问题：拥有驱动日志访问权限的攻击者可能观察到服务账号令牌。这些令牌随后可能被用于与外部云提供商交换，以访问存储在云保险库解决方案中的机密信息。仅当 [CSIDriver 对象中配置了 TokenRequests](https://kubernetes-csi.github.io/docs/token-requests.html) 且驱动通过 `-v` 标志设置为日志级别 2 或更高时，令牌才会被记录。  

此问题被评为 **中危** [CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:C/C:H/I:N/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:C/C:H/I:N/A:N) (6.5)，并分配编号 **CVE-2023-2878**。  

**我是否受影响？**  

如果 [CSIDriver 对象中配置了 TokenRequests](https://kubernetes-csi.github.io/docs/token-requests.html) 且驱动通过 `-v` 标志设置为日志级别 2 或更高，则可能受影响。  

检查是否配置了令牌请求：  

```shell  
kubectl get csidriver secrets-store.csi.k8s.io -o jsonpath="{.spec.tokenRequests}"  
```  

检查令牌是否被记录：  

```shell  
kubectl logs -l app=secrets-store-csi-driver -c secrets-store -f | grep --line-buffered "csi.storage.k8s.io/serviceAccount.tokens"  
```  

**受影响版本**  

- secrets-store-csi-driver < 1.3.3  

**如何缓解此漏洞？**  

在升级前，可通过将 secrets-store-csi-driver 的日志级别设为 0 或 1（通过 `-v` 标志）缓解此漏洞。  

**已修复版本**  

- secrets-store-csi-driver >= 1.3.3  

升级方法请参考文档：[https://secrets-store-csi-driver.sigs.k8s.io/getting-started/upgrades.html#upgrades](https://secrets-store-csi-driver.sigs.k8s.io/getting-started/upgrades.html#upgrades)  

**检测方法**  

检查云提供商日志中是否存在异常的令牌交换行为，以及对云保险库机密的异常访问。  

如发现漏洞被利用的证据，请联系 [security@kubernetes.io](mailto:security@kubernetes.io)。  

**致谢**  

此漏洞由 Microsoft 的 Tomer Shaiman `@tshaiman` 报告。  

/area security  
/kind bug  
/committee security-response  
/label official-cve-feed  
/sig auth