---### CVE-2023-2727：绕过 ImagePolicyWebhook 准入插件策略限制的安全漏洞  
CVSS 评分：[CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:N)  

在 Kubernetes 中发现一个安全问题：当使用临时容器（ephemeral containers）时，用户可能绕过 ImagePolicyWebhook 的限制启动被禁止的镜像。仅当同时启用 ImagePolicyWebhook 准入插件和临时容器功能时，Kubernetes 集群会受此漏洞影响。  

#### 我的集群是否受影响？  
若同时满足以下条件，则集群存在此漏洞风险：  

1. 使用 ImagePolicyWebhook 准入插件限制特定镜像的使用  
2. Pod 使用了临时容器  

#### 受影响版本  
- kube-apiserver v1.27.0 - v1.27.2  
- kube-apiserver v1.26.0 - v1.26.5  
- kube-apiserver v1.25.0 - v1.25.10  
- kube-apiserver <= v1.24.14  

#### 如何缓解此漏洞？  
可通过为 kube-apiserver 组件打补丁来修复此问题。该补丁会阻止临时容器使用被 ImagePolicyWebhook 限制的镜像。  

注：验证类 Webhook（如 [Gatekeeper](https://open-policy-agent.github.io/gatekeeper-library/website/validation/allowedrepos/) 和 [Kyverno](https://kyverno.io/policies/other/allowed-image-repos/allowed-image-repos/)）也可用于强制执行相同限制。  

#### 已修复版本  
- kube-apiserver v1.27.3  
- kube-apiserver v1.26.6  
- kube-apiserver v1.25.11  
- kube-apiserver v1.24.15  

#### 检测方法  
通过 API 审计日志可捕获使用临时容器绕过 ImagePolicyWebhook 限制的 Pod 更新请求。也可执行 `kubectl get pods` 检查集群中是否存在运行被限制镜像的临时容器。  

#### 致谢  
此漏洞由 Stanislav Láznička 报告，Rita Zhang 修复。  

---  

### CVE-2023-2728：绕过 ServiceAccount 准入插件强制挂载 Secret 策略的安全漏洞  
CVSS 评分：[CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:N)  

在 Kubernetes 中发现一个安全问题：当使用临时容器时，用户可能绕过 ServiceAccount 准入插件强制实施的 Secret 挂载策略。该策略确保 Pod 仅能挂载其 ServiceAccount 的 secrets 字段中指定的 Secret。仅当同时启用 ServiceAccount 准入插件、使用 `kubernetes.io/enforce-mountable-secrets` 注解和临时容器功能时，集群会受此漏洞影响。  

#### 我的集群是否受影响？  
若同时满足以下条件，则集群存在此漏洞风险：  

1. 启用了 ServiceAccount 准入插件（默认推荐配置，参见 [文档](https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#serviceaccount)）  
2. ServiceAccount 使用了 `kubernetes.io/enforce-mountable-secrets` 注解（默认不添加）  
3. Pod 使用了临时容器  

#### 受影响版本  
- kube-apiserver v1.27.0 - v1.27.2  
- kube-apiserver v1.26.0 - v1.26.5  
- kube-apiserver v1.25.0 - v1.25.10  
- kube-apiserver <= v1.24.14  

#### 如何缓解此漏洞？  
可通过为 kube-apiserver 组件打补丁来修复此问题。该补丁会阻止临时容器绕过 ServiceAccount 准入插件的 Secret 挂载策略。  

#### 已修复版本  
- kube-apiserver v1.27.3  
- kube-apiserver v1.26.6  
- kube-apiserver v1.25.11  
- kube-apiserver v1.24.15  

#### 检测方法  
通过 API 审计日志可捕获利用此漏洞挂载非授权 Secret 的临时容器请求。也可执行 `kubectl get pods` 检查集群中是否存在临时容器挂载了 ServiceAccount 未引用的 Secret。  

#### 致谢  
此漏洞由 Rita Zhang 报告并修复。  

若发现此漏洞被利用的证据，请联系 [security@kubernetes.io](mailto:security@kubernetes.io)  

/area security  
/kind bug  
/committee security-response  
/label official-cve-feed  
/sig auth  
/area apiserver