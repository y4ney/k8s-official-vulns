---### CVE-2023-2727：绕过 ImagePolicyWebhook 准入插件实施的镜像策略限制  
CVSS 评分：[CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:N)  

在 Kubernetes 中发现一个安全问题：当使用临时容器（ephemeral containers）时，用户可能能够启动被 ImagePolicyWebhook 限制的镜像。仅当同时使用 ImagePolicyWebhook 准入插件和临时容器时，Kubernetes 集群才会受此漏洞影响。  

#### 我的集群是否受影响？  
如果满足以下所有条件，则集群会受到此漏洞影响：  

1. 使用 ImagePolicyWebhook 准入插件限制某些镜像的使用  
2. Pod 使用了临时容器  

#### 受影响版本  
- kube-apiserver v1.27.0 - v1.27.2  
- kube-apiserver v1.26.0 - v1.26.5  
- kube-apiserver v1.25.0 - v1.25.10  
- kube-apiserver <= v1.24.14  

#### 如何缓解此漏洞？  
可以通过为 kube-apiserver 组件应用补丁来缓解此问题。该补丁可防止临时容器使用被 ImagePolicyWebhook 限制的镜像。  

注意：验证类 Webhook（如 [Gatekeeper](https://open-policy-agent.github.io/gatekeeper-library/website/validation/allowedrepos/) 和 [Kyverno](https://kyverno.io/policies/other/allowed-image-repos/allowed-image-repos/)）也可用于强制执行相同的限制。  

#### 已修复版本  
- kube-apiserver v1.27.3  
- kube-apiserver v1.26.6  
- kube-apiserver v1.25.11  
- kube-apiserver v1.24.15  

#### 检测方法  
使用临时容器并携带本应被 ImagePolicyWebhook 限制的镜像的 Pod 更新请求会被记录在 API 审计日志中。您也可以使用 `kubectl get pods` 查找集群中正在运行临时容器且使用了本应被限制的镜像的活跃 Pod。  

#### 致谢  
此漏洞由 Stanislav Láznička 报告，由 Rita Zhang 修复。  

---  

### CVE-2023-2728：绕过 ServiceAccount 准入插件实施的可挂载 Secret 策略  
CVSS 评分：[CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:N)  

在 Kubernetes 中发现一个安全问题：当使用临时容器时，用户可能能够绕过 ServiceAccount 准入插件实施的可挂载 Secret 策略。该策略确保使用服务账号运行的 Pod 只能引用该服务账号 secrets 字段中指定的 Secret。仅当同时使用 ServiceAccount 准入插件、`kubernetes.io/enforce-mountable-secrets` 注解和临时容器时，Kubernetes 集群才会受此漏洞影响。  

#### 我的集群是否受影响？  
如果满足以下所有条件，则集群会受到此漏洞影响：  

1. 使用了 ServiceAccount 准入插件。根据 [Kubernetes 文档建议](https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#serviceaccount)，大多数集群默认启用此插件  
2. 服务账号使用了 `kubernetes.io/enforce-mountable-secrets` 注解。此注解默认不添加  
3. Pod 使用了临时容器  

#### 受影响版本  
- kube-apiserver v1.27.0 - v1.27.2  
- kube-apiserver v1.26.0 - v1.26.5  
- kube-apiserver v1.25.0 - v1.25.10  
- kube-apiserver <= v1.24.14  

#### 如何缓解此漏洞？  
可以通过为 kube-apiserver 组件应用补丁来缓解此问题。该补丁可防止临时容器绕过 ServiceAccount 准入插件实施的可挂载 Secret 策略。  

#### 已修复版本  
- kube-apiserver v1.27.3  
- kube-apiserver v1.26.6  
- kube-apiserver v1.25.11  
- kube-apiserver v1.24.15  

#### 检测方法  
利用此漏洞携带非常规 Secret 的临时容器的 Pod 更新请求会被记录在 API 审计日志中。您也可以使用 `kubectl get pods` 查找集群中正在运行临时容器且使用了服务账号未引用的 Secret 的活跃 Pod。  

#### 致谢  
此漏洞由 Rita Zhang 报告并修复。  

如果您发现此漏洞被利用的证据，请联系 [security@kubernetes.io](mailto:security@kubernetes.io)  

/area security  
/kind bug  
/committee security-response  
/label official-cve-feed  
/sig auth  
/area apiserver