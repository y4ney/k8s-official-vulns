### 问题详情  
在 [ingress-nginx](https://github.com/kubernetes/ingress-nginx) 中发现一个安全问题：当 Ingress 对象（属于 `networking.k8s.io` 或 `extensions` API 组）使用 `nginx.ingress.kubernetes.io/permanent-redirect` 注解时，攻击者可借此注入任意命令并获取 ingress-nginx 控制器的凭据。默认配置下，该凭据拥有访问集群中所有 Secret 的权限。  

此问题被评为 **高危**（[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:L/A:L](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:L/A:L)），编号为 **CVE-2023-5044**。  

### 受影响组件与配置  

此漏洞影响 ingress-nginx。若集群未安装 ingress-nginx，则不受影响。可通过运行 `kubectl get po -n ingress-nginx` 确认。  

若使用 v1.2.0 引入的“chrooted”模式 ingress-nginx 控制器（`gcr.io/k8s-staging-ingress-nginx/controller-chroot`），攻击者可执行命令但无法提取凭据，因此不适用高危评级。  

在允许非管理员用户创建 Ingress 对象的多租户环境中，此问题影响最为严重。  

#### 受影响版本  
- <v1.9.0  

#### 可缓解漏洞的版本  
- v1.9.0  

### 缓解措施  
Ingress 管理员应设置 `--enable-annotation-validation` 标志，以强制限制 ingress-nginx 注解字段的内容。  

### 检测方法  
若发现此漏洞被利用的迹象，请联系 [security@kubernetes.io](mailto:security@kubernetes.io)。  

### 补充信息  
详见 ingress-nginx Issue [#10572](https://github.com/kubernetes/kubernetes/issues/126817)。  

### 致谢  
此漏洞由 Jan-Otto Kröpke（Cloudeteer GmbH）报告。  

此致  
Kubernetes 安全响应委员会  
CJ Cullen 代发