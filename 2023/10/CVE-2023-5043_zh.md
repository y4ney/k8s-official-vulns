---### 问题详情

在 [ingress-nginx](https://github.com/kubernetes/ingress-nginx) 中发现一个安全问题：Ingress 对象（属于 `networking.k8s.io` 或 `extensions` API 组）上的 `nginx.ingress.kubernetes.io/configuration-snippet` 注解可被用于注入任意命令，并获取 ingress-nginx 控制器的凭据。在默认配置中，该凭据拥有访问集群中所有 Secret 的权限。

此问题被评为 **高危** ([CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:L/A:L](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:L/A:L))，并分配了 **CVE-2023-5043** 编号。

### 受影响组件与配置
该漏洞影响 ingress-nginx。如果您的集群未安装 ingress-nginx，则不受影响。可通过运行 `kubectl get po -n ingress-nginx` 进行确认。

如果您运行的是 v1.2.0 引入的 "chrooted" ingress-nginx 控制器（gcr.io/k8s-staging-ingress-nginx/controller-chroot），虽然可以执行命令但无法提取凭据，因此不适用高危评级。

允许非管理员用户创建 Ingress 对象的多租户环境受此问题影响最大。

#### 受影响版本
- <v1.9.0

#### 可缓解漏洞的版本
- v1.9.0

### 缓解措施
Ingress 管理员应设置 `--enable-annotation-validation` 标志，以强制限制 ingress-nginx 注解字段的内容。

### 检测方法
如发现该漏洞被利用的证据，请联系 [security@kubernetes.io](mailto:security@kubernetes.io)

### 补充信息
更多详情请参阅 ingress-nginx Issue [kubernetes/kubernetes#126816](https://github.com/kubernetes/kubernetes/issues/126816)

### 致谢
此漏洞由 suanve 报告

感谢您，
Kubernetes 安全响应委员会代表 CJ Cullen