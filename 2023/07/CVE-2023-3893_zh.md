---CVSS 评分：[CVSS:3.1/av:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H) - **高危** (8.8)

在 Kubernetes 中发现一个安全问题：能够在运行 kubernetes-csi-proxy 的 Windows 节点上创建 Pod 的用户可能提升至该节点的管理员权限。仅包含运行 kubernetes-csi-proxy 的 Windows 节点的 Kubernetes 集群会受到影响。

### 我是否受影响？

任何运行 kubernetes-csi-proxy 的 Windows 节点的 Kubernetes 环境均受影响。这是 Windows 节点的常见默认配置。执行 `kubectl get nodes -l kubernetes.io/os=windows` 可查看是否使用了 Windows 节点。

#### 受影响版本

- kubernetes-csi-proxy <= v2.0.0-alpha.0  
- kubernetes-csi-proxy <= v1.1.2

### 如何缓解此漏洞？

提供的补丁可完全修复该漏洞且无已知副作用。针对此类问题的完整修复需同时应用 CVE-2023-3676、CVE-2023-3955 和 CVE-2023-3893 的补丁。

除应用提供的补丁外，目前无其他已知缓解措施。

#### 已修复版本

- kubernetes-csi-proxy master - 通过 https://github.com/kubernetes-csi/csi-proxy/pull/306 修复  
- kubernetes-csi-proxy v2.0.0-alpha.1 - 通过 https://github.com/kubernetes-csi/csi-proxy/pull/307 修复  
- kubernetes-csi-proxy v1.1.3 - 通过 https://github.com/kubernetes-csi/csi-proxy/pull/306 修复  

升级步骤：封锁节点 → 停止相关 Windows 服务 → 替换 csi-proxy.exe 二进制文件 → 重启相关 Windows 服务 → 解除节点封锁。详见安装文档：https://github.com/kubernetes-csi/csi-proxy#installation

若通过 Windows 主机进程 DaemonSet 运行 kubernetes-csi-proxy（例如 https://github.com/kubernetes-csi/csi-driver-smb/blob/master/charts/latest/csi-driver-smb/templates/csi-proxy-windows.yaml），只需将镜像升级至已修复版本（如 ghcr.io/kubernetes-sigs/sig-windows/csi-proxy:v1.1.3）。

### 检测方法

可通过 Kubernetes 审计日志检测是否遭受攻击。创建包含嵌入式 powershell 命令的 Pod 事件是明显的攻击迹象。

如发现漏洞利用证据，请联系 security@kubernetes.io

#### 致谢

此漏洞由 James Sturtevant @jsturtevant 和 Mark Rossetti @marosset 在修复 CVE-2023-3676 过程中发现（原漏洞由 Tomer Peled @tomerpeled92 报告）

修复与协调团队：  
James Sturtevant @jsturtevant  
Mark Rossetti @marosset  
Andy Zhang @andyzhangx  
Justin Terry @jterry75  
Kulwant Singh @KlwntSingh  
Micah Hausler @micahhausler  
Rita Zhang @ritazh  

以及发布经理：  
Mauricio Poppe @mauriciopoppe